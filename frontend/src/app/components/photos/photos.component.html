<div class="photos-page" (keydown)="handleKeydown($event)">
  <nav class="navbar">
    <div class="navbar-brand">Above Sky Calendar</div>
    <div class="navbar-menu">
      <a routerLink="/dashboard" class="nav-link">Dashboard</a>
      <a routerLink="/tasks" class="nav-link">Tasks</a>
      <a routerLink="/rewards" class="nav-link">Rewards</a>
      <a routerLink="/meals" class="nav-link">Meals</a>
      <a routerLink="/photos" class="nav-link active">Photos</a>
      <a routerLink="/lists" class="nav-link">Lists</a>
      <a routerLink="/calendar" class="nav-link">Calendar</a>
      @if (authState.currentUser(); as user) {
        <div class="user-info">
          <span>{{ user.username }}</span>
        </div>
      }
    </div>
  </nav>

  <div class="container">
    <div class="header">
      <div class="header-content">
        <h1>Photo Gallery</h1>
        <p class="subtitle">Share and view family memories</p>
      </div>
      <div class="header-actions">
        <button (click)="toggleUploadForm()" class="btn btn-primary">
          {{ showUploadForm() ? 'Cancel' : 'Upload Photo' }}
        </button>
      </div>
    </div>

    <!-- Upload Form -->
    @if (showUploadForm()) {
      <div class="upload-form-card">
        <h3>Upload New Photo</h3>
        <form (ngSubmit)="uploadPhoto()">
          <div class="form-group">
            <label for="filePath">Image URL</label>
            <input
              type="url"
              id="filePath"
              [(ngModel)]="newPhoto.filePath"
              name="filePath"
              required
              class="form-control"
              placeholder="https://example.com/image.jpg"
            />
          </div>

          <div class="form-group">
            <label for="caption">Caption (optional)</label>
            <textarea
              id="caption"
              [(ngModel)]="newPhoto.caption"
              name="caption"
              rows="2"
              class="form-control"
              placeholder="Add a caption for this photo..."
            ></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Upload Photo</button>
        </form>
      </div>
    }

    @if (loading()) {
      <div class="loading">Loading photos...</div>
    }

    @if (!loading() && photos().length === 0) {
      <div class="no-photos">
        <p>No photos yet. Upload your first photo!</p>
      </div>
    }

    <!-- Photo Grid -->
    @if (!loading() && photos().length > 0) {
      <div class="photo-grid">
        @for (photo of photos(); track photo.id; let i = $index) {
          <div 
            class="photo-item"
            (click)="openLightbox(i)"
          >
            <div class="photo-wrapper">
              <img [src]="photo.filePath" [alt]="photo.caption || 'Photo'" />
              <div class="photo-overlay">
                @if (photo.caption) {
                  <div class="photo-caption">{{ photo.caption }}</div>
                }
                <div class="photo-date">{{ photo.uploadedAt | date:'medium' }}</div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Lightbox -->
  @if (showLightbox()) {
    <div class="lightbox-overlay" (click)="closeLightbox()"></div>
  }
  
  @if (showLightbox() && getCurrentPhoto(); as currentPhoto) {
    <div class="lightbox">
      <button class="lightbox-close" (click)="closeLightbox()">&times;</button>
      <button 
        class="lightbox-nav lightbox-prev" 
        (click)="previousPhoto(); $event.stopPropagation()"
        [disabled]="currentPhotoIndex() === 0"
      >
        ‹
      </button>
      <button 
        class="lightbox-nav lightbox-next" 
        (click)="nextPhoto(); $event.stopPropagation()"
        [disabled]="currentPhotoIndex() === photos().length - 1"
      >
        ›
      </button>
      
      <div class="lightbox-content" (click)="$event.stopPropagation()">
        <img [src]="currentPhoto.filePath" [alt]="currentPhoto.caption || 'Photo'" />
        
        <div class="lightbox-info">
          @if (currentPhoto.caption) {
            <div class="lightbox-caption">
              {{ currentPhoto.caption }}
            </div>
          }
          <div class="lightbox-meta">
            <span class="lightbox-date">{{ currentPhoto.uploadedAt | date:'medium' }}</span>
            <span class="lightbox-counter">{{ currentPhotoIndex() + 1 }} / {{ photos().length }}</span>
          </div>
          <div class="lightbox-actions">
            <button (click)="deletePhoto(currentPhoto.id)" class="btn btn-danger btn-sm">
              Delete Photo
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
